<link rel="stylesheet" href="../css/styles.css"/>
<% if(!details.covers){ %> 
    <p>No Cover Image Available</p>
<% }else{ %> 
        <img src ="https://covers.openlibrary.org/b/id/<%=details.covers[0]%>-L.jpg" />
<% } %>
<h1><%= details.title %> </h1>
<h2><%= author.name %> </h2>

<% if(typeof(details.description) === "string"){ %> 
    <p><%= details.description %> </p>
<% }else if(typeof(details.description) === 'object'){ %> 
        <p><%= details.description.value %> </p>
<% }else{ %> 
    <p>No Description Available</p>
<% } %> 
<% if(!details.links){ %> 
<% }else{ %> 
    <ul>Links:
        <% details.links.forEach(link => { %>
            <li>
                <a href="<%= link.url%>"><%= link.title %> </a>
            </li>
    <% }) %> 
    </ul>
<% } %> 
<% if(!savedBook){ %> 
<form method="POST" action="/users/profile">
    <input hidden value="<%= details.key %>" name="bookid"/>
    <input hidden value="<%= details.title %>" name="title"/>
    <input hidden value="<%= author.name %>" name="author"/>
    <% if(!details.covers){ %> 
    <% }else{ %> 
    <input hidden value="https://covers.openlibrary.org/b/id/<%=details.covers[0]%>-L.jpg" name="books_cover_url"/>
    <% } %>
    <input hidden value="<%= user.id %> " name="userId"/>
    <button type="submit">Save this book!</button>
</form>
<% } else{ %> 
    <ul>Tags:
        <% relevantTags.forEach(tag =>{ %> 
            <li>
                <%= tag.title %>
                <form method="POST" action="/books/details/?_method=DELETE">
                    <input hidden value="<%= details.key %>" name="bookKey"/>
                    <input hidden value="<%= savedBook.id %>" name="bookId"/>
                    <input hidden value="<%= user.id %> " name="userId"/>
                    <input hidden value="<%= tag.id %> " name="tagId"/>
                    <button type="submit">Remove Tag</button>
                  </form>
            </li>
        <% }) %> 
    </ul>
    <form method="POST" action="/books/details/?_method=PUT">
        <input hidden value="<%= details.key %>" name="bookKey"/>
        <input hidden value="<%= savedBook.id %>" name="bookId"/>
        <input hidden value="<%= user.id %> " name="userId"/>
        <label for="editTags">Choose a tag:</label>
        <select id="editTags" name="title">
            <% tags.forEach(tag=>{ %> 
                <option name="title" value="<%=tag.title%>"><%=tag.title%></option>
            <% }) %> 
        </select>
        <button type="submit">EditTags!</button>
    </form>
    <form method="POST" action="/books/details">
        <input hidden value="<%= details.key %>" name="bookKey"/>
        <input hidden value="<%= savedBook.id %>" name="bookId"/>
        <input hidden value="<%= user.id %> " name="userId"/>
        <label for="addTag">Make a New Tag</label>
        <input id ="addTag" type="text" name="title"/>
        <button type="submit">Add Tags!</button>
    </form>

<% } %>
<!-- <a href="/books/results">Back</a> -->
